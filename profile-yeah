<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Ê∂àÂ§±ÁöÑÊñπÂ°ä - Memory Tap</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      margin: 20px 0 10px;
    }

    #info {
      font-size: 18px;
      margin-bottom: 10px;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(3, 90px);
      gap: 12px;
      justify-content: center;
      margin: 20px auto;
    }

    .cell {
      width: 90px;
      height: 90px;
      background: #444;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .cell:active {
      transform: scale(0.95);
    }

    .active {
      background: #f1c40f;
    }

    .correct {
      background: #2ecc71;
    }

    .wrong {
      background: #e74c3c;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>üß† Ê∂àÂ§±ÁöÑÊñπÂ°ä</h1>

<div id="info">
  ÈóúÂç°Ôºö<span id="level">1</span>„ÄÄ
  ÁîüÂëΩÔºö<span id="life">3</span>
</div>

<div id="grid"></div>

<button onclick="startGame()">ÈñãÂßãÈÅäÊà≤</button>

<script>
  const grid = document.getElementById("grid");
  const levelText = document.getElementById("level");
  const lifeText = document.getElementById("life");

  let level = 1;
  let life = 3;
  let activeCells = [];
  let clickedCells = [];
  let canClick = false;

  const gridSize = 9; // 3x3

  function startGame() {
    level = 1;
    life = 3;
    updateUI();
    createGrid();
    startLevel();
  }

  function createGrid() {
    grid.innerHTML = "";
    for (let i = 0; i < gridSize; i++) {
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.index = i;
      cell.addEventListener("click", () => handleClick(i, cell));
      grid.appendChild(cell);
    }
  }

  function startLevel() {
    canClick = false;
    clickedCells = [];
    activeCells = [];

    const cellCount = Math.min(2 + level, gridSize);
    const indices = [...Array(gridSize).keys()];

    shuffle(indices);
    activeCells = indices.slice(0, cellCount);

    activeCells.forEach(i => {
      grid.children[i].classList.add("active");
    });

    setTimeout(() => {
      activeCells.forEach(i => {
        grid.children[i].classList.remove("active");
      });
      canClick = true;
    }, Math.max(1200 - level * 100, 400));
  }

  function handleClick(index, cell) {
    if (!canClick || clickedCells.includes(index)) return;

    clickedCells.push(index);

    if (activeCells.includes(index)) {
      cell.classList.add("correct");
    } else {
      cell.classList.add("wrong");
      life--;
      updateUI();
      canClick = false;
      setTimeout(checkGameOver, 600);
      return;
    }

    if (clickedCells.length === activeCells.length) {
      canClick = false;
      setTimeout(() => {
        level++;
        updateUI();
        resetCells();
        startLevel();
      }, 600);
    }
  }

  function resetCells() {
    [...grid.children].forEach(cell => {
      cell.classList.remove("correct", "wrong");
    });
  }

  function checkGameOver() {
    if (life <= 0) {
      alert("ÈÅäÊà≤ÁµêÊùüÔºÅ‰Ω†Âà∞ÈÅîÁ¨¨ " + level + " Èóú");
      canClick = false;
    } else {
      resetCells();
      startLevel();
    }
  }

  function updateUI() {
    levelText.textContent = level;
    lifeText.textContent = life;
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }
</script>

</body>
</html>
